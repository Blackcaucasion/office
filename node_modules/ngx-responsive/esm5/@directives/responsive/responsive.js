import { __decorate, __values } from "tslib";
/**
 * @name responsive
 * @description Responsive directive in ngx-responsive
 *
 * @license MIT
 */
import { Output, EventEmitter, Directive, Input, TemplateRef, ViewContainerRef, OnDestroy, ChangeDetectorRef } from '@angular/core';
import { ResponsiveState } from '../../@core/providers/responsive-state/responsive-state';
import { PlatformService } from '../../@core/providers/platform-service/platform.service';
var ResponsiveDirective = /** @class */ (function () {
    function ResponsiveDirective(templateRef, _responsiveState, viewContainer, cd, platformService) {
        this.templateRef = templateRef;
        this._responsiveState = _responsiveState;
        this.viewContainer = viewContainer;
        this.cd = cd;
        this.changes = new EventEmitter();
        this._windows = null;
        this._window = null;
        this._isEnabledForPlatform = null;
        this.set_values = {
            bootstrap: '',
            browser: '',
            device: '',
            pixelratio: '',
            orientation: '',
            standard: '',
            ie: '',
            sizes: 0
        };
        this.set_active_subscriptions = {
            bootstrap: false,
            browser: false,
            device: false,
            pixelratio: false,
            orientation: false,
            standard: false,
            ie: false,
            sizes: false
        };
        this.match_multiple = {
            bootstrap: false,
            browser: false,
            device: false,
            pixelratio: false,
            orientation: false,
            standard: false,
            ie: false,
            sizes: false
        };
        this._showWhenTrue = true;
        this._globalNoRepeat = 0;
        this._bootstrapNoRepeat = 0;
        this._deviceNoRepeat = 0;
        this._standardNoRepeat = 0;
        this._orientationNoRepeat = 0;
        this._browserNoRepeat = 0;
        this._pixelratioNoRepeat = 0;
        this._ieNoRepeat = 0;
        this._sizesNoRepeat = 0;
        this._bootstrap_user_param = [];
        this._devices_user_param = [];
        this._standard_user_param = [];
        this._orientation_user_param = [];
        this._browser_user_param = [];
        this._pixelratio_user_param = [];
        this._ie_user_param = [];
        this._sizes_user_param = [0, Number.MAX_VALUE];
        this._sizes_window = 'window';
        // private _sizes_container = null;
        this._actives = [];
        this._isEnabledForPlatform = platformService.isEnabledForPlatform();
    }
    Object.defineProperty(ResponsiveDirective.prototype, "responsive", {
        set: function (config) {
            this._config = config;
            this.init_responsive();
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(ResponsiveDirective.prototype, "config", {
        get: function () {
            return this._config;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(ResponsiveDirective.prototype, "responsiveContainer", {
        get: function () {
            return this._responsiveContainer;
        },
        set: function (value) {
            this._responsiveContainer = value;
            if (this.config) {
                if (this._sizes_window !== null && this._sizes_window !== "window") {
                    throw new Error('Responsive directive cannot use window AND responsiveContainer together');
                }
                this.init_responsive();
            }
        },
        enumerable: true,
        configurable: true
    });
    ResponsiveDirective.prototype.init_responsive = function () {
        var config = this.config;
        if (this.isJSON(config)) {
            if (!!config.bootstrap && this._bootstrapNoRepeat === 0) {
                this._bootstrap_user_param = (Array.isArray(config.bootstrap) ? config.bootstrap : [config.bootstrap]);
                this._bootstrapNoRepeat = 1;
                this.set_active_subscriptions.bootstrap = true;
            }
            if (!!config.device && this._deviceNoRepeat === 0) {
                this._devices_user_param = (Array.isArray(config.device) ? config.device : [config.device]);
                this._deviceNoRepeat = 1;
                this.set_active_subscriptions.device = true;
            }
            if (!!config.standard && this._standardNoRepeat === 0) {
                this._standard_user_param = (Array.isArray(config.standard) ? config.standard : [config.standard]);
                this._standardNoRepeat = 1;
                this.set_active_subscriptions.standard = true;
            }
            if (!!config.orientation && this._orientationNoRepeat === 0) {
                this._orientation_user_param = (Array.isArray(config.orientation) ? config.orientation : [config.orientation]);
                this._orientationNoRepeat = 1;
                this.set_active_subscriptions.orientation = true;
            }
            if (!!config.browser && this._browserNoRepeat === 0) {
                this._browser_user_param = (Array.isArray(config.browser) ? config.browser : [config.browser]);
                this._browserNoRepeat = 1;
                this.set_active_subscriptions.browser = true;
            }
            if (!!config.pixelratio && this._pixelratioNoRepeat === 0) {
                this._pixelratio_user_param = (Array.isArray(config.pixelratio) ? config.pixelratio : [config.pixelratio]);
                this._pixelratioNoRepeat = 1;
                this.set_active_subscriptions.pixelratio = true;
            }
            if (!!config.ie && this._ieNoRepeat === 0) {
                this._ie_user_param = (Array.isArray(config.ie) ? config.ie : [config.ie]);
                this._ieNoRepeat = 1;
                this.set_active_subscriptions.ie = true;
            }
            if (!!config.sizes && this._sizesNoRepeat === 0) {
                var _min = config.sizes.min || 0;
                var _max = config.sizes.max || Number.MAX_VALUE;
                var _win = config.sizes.window;
                if (_win !== undefined) {
                    this._sizes_window = _win;
                }
                // this._sizes_container = value.sizes.container;
                this._sizes_user_param = [_min, _max];
                this._sizesNoRepeat = 1;
                this.set_active_subscriptions.sizes = true;
            }
        }
        else if (Array.isArray(config)) {
            throw new Error('Responsive directive don´t work with a only array parameter');
        }
        else if (typeof config === 'string') {
            throw new Error('Responsive directive don´t work with a only string parameter');
        }
        else if (typeof config === 'number') {
            throw new Error('Responsive directive don´t work with a only number parameter');
        }
        else if (typeof config === 'undefined' || config === null) {
            throw new Error('Responsive directive don´t work without a param');
        }
        for (var key in this.set_active_subscriptions) {
            if (this.set_active_subscriptions[key]) {
                this._actives.push(key);
            }
        }
        if (this._isEnabledForPlatform) {
            if (this.set_active_subscriptions.bootstrap) {
                this._subscription_Bootstrap = this._responsiveState.elemento$.subscribe(this.updateBootstrap.bind(this));
            }
            if (this.set_active_subscriptions.browser) {
                this._subscription_Browser = this._responsiveState.browser$.subscribe(this.updateBrowser.bind(this));
            }
            if (this.set_active_subscriptions.device) {
                this._subscription_Device = this._responsiveState.device$.subscribe(this.updateDevice.bind(this));
            }
            if (this.set_active_subscriptions.pixelratio) {
                this._subscription_Pixel_Ratio = this._responsiveState.pixel$.subscribe(this.updatePixelRatio.bind(this));
            }
            if (this.set_active_subscriptions.orientation) {
                this._subscription_Orientation = this._responsiveState.orientation$.subscribe(this.updateOrientation.bind(this));
            }
            if (this.set_active_subscriptions.standard) {
                this._subscription_Standard = this._responsiveState.standard$.subscribe(this.updateStandard.bind(this));
            }
            if (this.set_active_subscriptions.ie) {
                this._subscription_IE_Version = this._responsiveState.ieVersion$.subscribe(this.updateIEversion.bind(this));
            }
            if (this.set_active_subscriptions.sizes) {
                this._subscription_custom_sizes = this._responsiveState.ancho$.subscribe(this.updateSizes.bind(this));
            }
        }
    };
    ResponsiveDirective.prototype.updateBootstrap = function (value) {
        var _update = this._ifValueChanged(this._noRepeatBootstrapName, value);
        if (_update) {
            this.set_values.bootstrap = value;
        }
        this.updateEvent(this.set_values.bootstrap, 'bootstrap');
    };
    ResponsiveDirective.prototype.updateBrowser = function (value) {
        this.set_values.browser = value;
        this.updateEvent(this.set_values.browser, 'browser');
    };
    ResponsiveDirective.prototype.updateDevice = function (value) {
        this.set_values.device = value;
        this.updateEvent(this.set_values.device, 'device');
    };
    ResponsiveDirective.prototype.updatePixelRatio = function (value) {
        this.set_values.pixelratio = value;
        this.updateEvent(this.set_values.pixelratio, 'pixelratio');
    };
    ResponsiveDirective.prototype.updateOrientation = function (value) {
        this.set_values.orientation = value;
        this.updateEvent(this.set_values.orientation, 'orientation');
    };
    ResponsiveDirective.prototype.updateStandard = function (value) {
        this.set_values.standard = value;
        this.updateEvent(this.set_values.standard, 'standard');
    };
    ResponsiveDirective.prototype.updateIEversion = function (value) {
        this.set_values.ie = value;
        this.updateEvent(this.set_values.ie, 'ie');
    };
    ResponsiveDirective.prototype.updateSizes = function (value) {
        if (this.responsiveContainer) {
            this.set_values.sizes = this._isEnabledForPlatform ? this.responsiveContainer.getWidth() : 0;
        }
        else if (this._sizes_window) {
            this.set_values.sizes = this._responsiveState.getWidth(this._sizes_window);
        }
        else {
            this.set_values.sizes = value;
        }
        this.updateEvent(this.set_values.sizes, 'sizes');
    };
    ResponsiveDirective.prototype.updateEvent = function (param, type_directive) {
        if (!!this._showWhenTrue) {
            switch (type_directive) {
                case 'bootstrap':
                    this.showHideOperations(this._bootstrap_user_param.indexOf(param) !== -1, type_directive);
                    break;
                case 'device':
                    this.showHideOperations(this._devices_user_param.indexOf(param) !== -1, type_directive);
                    break;
                case 'standard':
                    this.showHideOperations(this._standard_user_param.indexOf(param) !== -1, type_directive);
                    break;
                case 'orientation':
                    this.showHideOperations(this._orientation_user_param.indexOf(param) !== -1, type_directive);
                    break;
                case 'browser':
                    this.showHideOperations(this._browser_user_param.indexOf(param) !== -1, type_directive);
                    break;
                case 'pixelratio':
                    this.showHideOperations(this._pixelratio_user_param.indexOf(param) !== -1, type_directive);
                    break;
                case 'ie':
                    this.showHideOperations(this._ie_user_param.indexOf(param) !== -1, type_directive);
                    break;
                case 'sizes':
                    this.showHideOperations((param >= this._sizes_user_param[0] &&
                        param < this._sizes_user_param[1]), type_directive);
                    break;
            }
        }
        else {
            switch (type_directive) {
                case 'bootstrap':
                    this.showHideOperations(!(this._bootstrap_user_param.indexOf(param)), type_directive);
                    break;
                case 'device':
                    this.showHideOperations(!(this._devices_user_param.indexOf(param)), type_directive);
                    break;
                case 'standard':
                    this.showHideOperations(!(this._standard_user_param.indexOf(param)), type_directive);
                    break;
                case 'orientation':
                    this.showHideOperations(!(this._orientation_user_param.indexOf(param)), type_directive);
                    break;
                case 'browser':
                    this.showHideOperations(!(this._browser_user_param.indexOf(param)), type_directive);
                    break;
                case 'pixelratio':
                    this.showHideOperations(!(this._pixelratio_user_param.indexOf(param)), type_directive);
                    break;
                case 'ie':
                    this.showHideOperations(!(this._ie_user_param.indexOf(param)), type_directive);
                    break;
                case 'sizes':
                    this.showHideOperations(!((param >= this._sizes_user_param[0] &&
                        param < this._sizes_user_param[1])), type_directive);
                    break;
            }
        }
    };
    ResponsiveDirective.prototype.showHideOperations = function (show, type_directive) {
        var global_state = this.matchValues(show, type_directive);
        if (!!global_state) {
            if (this._globalNoRepeat === 0) {
                this._globalNoRepeat = 1;
                this.viewContainer.createEmbeddedView(this.templateRef);
                this.changes.emit(true);
                this.cd.markForCheck();
            }
        }
        else {
            this._globalNoRepeat = 0;
            this.changes.emit(false);
            this.viewContainer.clear();
            this.cd.markForCheck();
        }
    };
    ResponsiveDirective.prototype.matchValues = function (show, type_directive) {
        var e_1, _a;
        var match = true;
        if (show) {
            this.match_multiple[type_directive] = true;
        }
        else {
            this.match_multiple[type_directive] = false;
        }
        for (var all_key in this.match_multiple) {
            try {
                for (var _b = (e_1 = void 0, __values(this._actives)), _c = _b.next(); !_c.done; _c = _b.next()) {
                    var active = _c.value;
                    if (all_key == active && this.match_multiple[all_key] === false)
                        return match = false;
                }
            }
            catch (e_1_1) { e_1 = { error: e_1_1 }; }
            finally {
                try {
                    if (_c && !_c.done && (_a = _b.return)) _a.call(_b);
                }
                finally { if (e_1) throw e_1.error; }
            }
        }
        return match;
    };
    ResponsiveDirective.prototype.ngOnDestroy = function () {
        if (this._isEnabledForPlatform) {
            if (this.set_active_subscriptions.bootstrap) {
                this._subscription_Bootstrap.unsubscribe();
            }
            if (this.set_active_subscriptions.browser) {
                this._subscription_Browser.unsubscribe();
            }
            if (this.set_active_subscriptions.device) {
                this._subscription_Device.unsubscribe();
            }
            if (this.set_active_subscriptions.pixelratio) {
                this._subscription_Pixel_Ratio.unsubscribe();
            }
            if (this.set_active_subscriptions.orientation) {
                this._subscription_Orientation.unsubscribe();
            }
            if (this.set_active_subscriptions.standard) {
                this._subscription_Standard.unsubscribe();
            }
            if (this.set_active_subscriptions.ie) {
                this._subscription_IE_Version.unsubscribe();
            }
            if (this.set_active_subscriptions.sizes) {
                this._subscription_custom_sizes.unsubscribe();
            }
        }
    };
    ResponsiveDirective.prototype._ifValueChanged = function (oldValue, newValue) {
        if (oldValue === newValue) {
            return false;
        }
        else {
            this._noRepeatBootstrapName = newValue;
            return true;
        }
    };
    ResponsiveDirective.prototype.isJSON = function (value) {
        try {
            JSON.stringify(value);
            return true;
        }
        catch (ex) {
            return false;
        }
    };
    ResponsiveDirective.ctorParameters = function () { return [
        { type: TemplateRef },
        { type: ResponsiveState },
        { type: ViewContainerRef },
        { type: ChangeDetectorRef },
        { type: PlatformService }
    ]; };
    __decorate([
        Input()
    ], ResponsiveDirective.prototype, "responsive", null);
    __decorate([
        Input()
    ], ResponsiveDirective.prototype, "responsiveContainer", null);
    __decorate([
        Output()
    ], ResponsiveDirective.prototype, "changes", void 0);
    ResponsiveDirective = __decorate([
        Directive({
            selector: '[responsive]'
        })
    ], ResponsiveDirective);
    return ResponsiveDirective;
}());
export { ResponsiveDirective };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicmVzcG9uc2l2ZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL25neC1yZXNwb25zaXZlLyIsInNvdXJjZXMiOlsiQGRpcmVjdGl2ZXMvcmVzcG9uc2l2ZS9yZXNwb25zaXZlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQTs7Ozs7R0FLRztBQUNILE9BQU8sRUFBRSxNQUFNLEVBQUUsWUFBWSxFQUFFLFNBQVMsRUFBRSxLQUFLLEVBQUUsV0FBVyxFQUFFLGdCQUFnQixFQUFFLFNBQVMsRUFBRSxpQkFBaUIsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQU1wSSxPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0seURBQXlELENBQUM7QUFFMUYsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLHlEQUF5RCxDQUFDO0FBTTFGO0lBcUdJLDZCQUNXLFdBQWdDLEVBQy9CLGdCQUFpQyxFQUNqQyxhQUErQixFQUMvQixFQUFxQixFQUM3QixlQUFnQztRQUp6QixnQkFBVyxHQUFYLFdBQVcsQ0FBcUI7UUFDL0IscUJBQWdCLEdBQWhCLGdCQUFnQixDQUFpQjtRQUNqQyxrQkFBYSxHQUFiLGFBQWEsQ0FBa0I7UUFDL0IsT0FBRSxHQUFGLEVBQUUsQ0FBbUI7UUE5RXZCLFlBQU8sR0FBc0IsSUFBSSxZQUFZLEVBQUUsQ0FBQztRQUNsRCxhQUFRLEdBQUcsSUFBSSxDQUFDO1FBQ2hCLFlBQU8sR0FBRyxJQUFJLENBQUM7UUFDZiwwQkFBcUIsR0FBWSxJQUFJLENBQUM7UUFDdkMsZUFBVSxHQUF1QjtZQUNwQyxTQUFTLEVBQUUsRUFBRTtZQUNiLE9BQU8sRUFBRSxFQUFFO1lBQ1gsTUFBTSxFQUFFLEVBQUU7WUFDVixVQUFVLEVBQUUsRUFBRTtZQUNkLFdBQVcsRUFBRSxFQUFFO1lBQ2YsUUFBUSxFQUFFLEVBQUU7WUFDWixFQUFFLEVBQUUsRUFBRTtZQUNOLEtBQUssRUFBRSxDQUFDO1NBQ1gsQ0FBQztRQUVNLDZCQUF3QixHQUM1QjtZQUNJLFNBQVMsRUFBRSxLQUFLO1lBQ2hCLE9B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UixLQUFLLEVBQUU7eURBR1A7SUFRRDtRQURDLEtBQUssRUFBRTtrRUFTUDtJQUtTO1FBQVQsTUFBTSxFQUFFO3dEQUFpRDtJQTNCakQsbUJBQW1CO1FBSi9CLFNBQVMsQ0FDTjtZQUNJLFFBQVEsRUFBRSxjQUFjO1NBQzNCLENBQUM7T0FDTyxtQkFBbUIsQ0FzWi9CO0lBQUQsMEJBQUM7Q0FBQSxBQXRaRCxJQXNaQztTQXRaWSxtQkFBbUIiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcclxuICogQG5hbWUgcmVzcG9uc2l2ZVxyXG4gKiBAZGVzY3JpcHRpb24gUmVzcG9uc2l2ZSBkaXJlY3RpdmUgaW4gbmd4LXJlc3BvbnNpdmVcclxuICpcclxuICogQGxpY2Vuc2UgTUlUXHJcbiAqL1xyXG5pbXBvcnQgeyBPdXRwdXQsIEV2ZW50RW1pdHRlciwgRGlyZWN0aXZlLCBJbnB1dCwgVGVtcGxhdGVSZWYsIFZpZXdDb250YWluZXJSZWYsIE9uRGVzdHJveSwgQ2hhbmdlRGV0ZWN0b3JSZWYgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgUExBVEZPUk1fSUQsIEluamVjdCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBpc1BsYXRmb3JtQnJvd3NlciB9IGZyb20gJ0Bhbmd1bGFyL2NvbW1vbic7XHJcbmltcG9ydCB7IFN1YnNjcmlwdGlvbiB9IGZyb20gJ3J4anMnO1xyXG5cclxuaW1wb3J0IHsgSVJlc3BvbnNpdmVQYXR0ZXJuLCBJUmVzcG9uc2l2ZVN1YnNjcmlwdGlvbnMgfSBmcm9tICcuLi8uLi9AY29yZSc7XHJcbmltcG9ydCB7IFJlc3BvbnNpdmVTdGF0ZSB9IGZyb20gJy4uLy4uL0Bjb3JlL3Byb3ZpZGVycy9yZXNwb25zaXZlLXN0YXRlL3Jlc3BvbnNpdmUtc3RhdGUnO1xyXG5pbXBvcnQgeyBSZXNwb25zaXZlV2luZG93RGlyZWN0aXZlIH0gZnJvbSBcIi4uL3Jlc3BvbnNpdmUtd2luZG93L3Jlc3BvbnNpdmUtd2luZG93XCI7XHJcbmltcG9ydCB7IFBsYXRmb3JtU2VydmljZSB9IGZyb20gJy4uLy4uL0Bjb3JlL3Byb3ZpZGVycy9wbGF0Zm9ybS1zZXJ2aWNlL3BsYXRmb3JtLnNlcnZpY2UnO1xyXG5cclxuQERpcmVjdGl2ZShcclxuICAgIHtcclxuICAgICAgICBzZWxlY3RvcjogJ1tyZXNwb25zaXZlXSdcclxuICAgIH0pXHJcbmV4cG9ydCBjbGFzcyBSZXNwb25zaXZlRGlyZWN0aXZlIGltcGxlbWVudHMgT25EZXN0cm95IHtcclxuXHJcbiAgICBwcml2YXRlIF9jb25maWc6IHN0cmluZyB8IHN0cmluZ1tdO1xyXG4gICAgQElucHV0KCkgc2V0IHJlc3BvbnNpdmUoY29uZmlnOiBzdHJpbmcgfCBzdHJpbmdbXSkge1xyXG4gICAgICAgIHRoaXMuX2NvbmZpZyA9IGNvbmZpZztcclxuICAgICAgICB0aGlzLmluaXRfcmVzcG9uc2l2ZSgpO1xyXG4gICAgfVxyXG4gICAgZ2V0IGNvbmZpZygpOiBzdHJpbmcgfCBzdHJpbmdbXXtcclxuICAgICAgICByZXR1cm4gdGhpcy5fY29uZmlnO1xyXG4gICAgfVxyXG4gICAgXHJcbiAgICAvLyBASW5wdXQoKSByZXNwb25zaXZlQ29udGFpbmVyOiBSZXNwb25zaXZlV2luZG93RGlyZWN0aXZlO1xyXG4gICAgcHJpdmF0ZSBfcmVzcG9uc2l2ZUNvbnRhaW5lcjpSZXNwb25zaXZlV2luZG93RGlyZWN0aXZlO1xyXG4gICAgQElucHV0KCkgXHJcbiAgICBzZXQgcmVzcG9uc2l2ZUNvbnRhaW5lcih2YWx1ZTogUmVzcG9uc2l2ZVdpbmRvd0RpcmVjdGl2ZSkge1xyXG4gICAgICB0aGlzLl9yZXNwb25zaXZlQ29udGFpbmVyID0gdmFsdWU7XHJcbiAgICAgIGlmKHRoaXMuY29uZmlnKXtcclxuICAgICAgICAgIGlmKHRoaXMuX3NpemVzX3dpbmRvdyAhPT0gbnVsbCAmJiB0aGlzLl9zaXplc193aW5kb3cgIT09IFwid2luZG93XCIpIHtcclxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdSZXNwb25zaXZlIGRpcmVjdGl2ZSBjYW5ub3QgdXNlIHdpbmRvdyBBTkQgcmVzcG9uc2l2ZUNvbnRhaW5lciB0b2dldGhlcicpO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgdGhpcy5pbml0X3Jlc3BvbnNpdmUoKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgZ2V0IHJlc3BvbnNpdmVDb250YWluZXIoKTogUmVzcG9uc2l2ZVdpbmRvd0RpcmVjdGl2ZXtcclxuICAgICAgICByZXR1cm4gdGhpcy5fcmVzcG9uc2l2ZUNvbnRhaW5lcjtcclxuICAgIH1cclxuXHJcbiAgICBAT3V0cHV0KCkgY2hhbmdlczogRXZlbnRFbWl0dGVyPGFueT4gPSBuZXcgRXZlbnRFbWl0dGVyKCk7XHJcbiAgICBwcml2YXRlIF93aW5kb3dzID0gbnVsbDtcclxuICAgIHByaXZhdGUgX3dpbmRvdyA9IG51bGw7XHJcbiAgICBwcml2YXRlIF9pc0VuYWJsZWRGb3JQbGF0Zm9ybTogYm9vbGVhbiA9IG51bGw7XHJcbiAgICBwdWJsaWMgc2V0X3ZhbHVlczogSVJlc3BvbnNpdmVQYXR0ZXJuID0ge1xyXG4gICAgICAgIGJvb3RzdHJhcDogJycsXHJcbiAgICAgICAgYnJvd3NlcjogJycsXHJcbiAgICAgICAgZGV2aWNlOiAnJyxcclxuICAgICAgICBwaXhlbHJhdGlvOiAnJyxcclxuICAgICAgICBvcmllbnRhdGlvbjogJycsXHJcbiAgICAgICAgc3RhbmRhcmQ6ICcnLFxyXG4gICAgICAgIGllOiAnJyxcclxuICAgICAgICBzaXplczogMFxyXG4gICAgfTtcclxuXHJcbiAgICBwcml2YXRlIHNldF9hY3RpdmVfc3Vic2NyaXB0aW9uczogSVJlc3BvbnNpdmVTdWJzY3JpcHRpb25zID1cclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGJvb3RzdHJhcDogZmFsc2UsXHJcbiAgICAgICAgICAgIGJyb3dzZXI6IGZhbHNlLFxyXG4gICAgICAgICAgICBkZXZpY2U6IGZhbHNlLFxyXG4gICAgICAgICAgICBwaXhlbHJhdGlvOiBmYWxzZSxcclxuICAgICAgICAgICAgb3JpZW50YXRpb246IGZhbHNlLFxyXG4gICAgICAgICAgICBzdGFuZGFyZDogZmFsc2UsXHJcbiAgICAgICAgICAgIGllOiBmYWxzZSxcclxuICAgICAgICAgICAgc2l6ZXM6IGZhbHNlXHJcbiAgICAgICAgfTtcclxuICAgIHByaXZhdGUgbWF0Y2hfbXVsdGlwbGU6IElSZXNwb25zaXZlU3Vic2NyaXB0aW9ucyA9XHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBib290c3RyYXA6IGZhbHNlLFxyXG4gICAgICAgICAgICBicm93c2VyOiBmYWxzZSxcclxuICAgICAgICAgICAgZGV2aWNlOiBmYWxzZSxcclxuICAgICAgICAgICAgcGl4ZWxyYXRpbzogZmFsc2UsXHJcbiAgICAgICAgICAgIG9yaWVudGF0aW9uOiBmYWxzZSxcclxuICAgICAgICAgICAgc3RhbmRhcmQ6IGZhbHNlLFxyXG4gICAgICAgICAgICBpZTogZmFsc2UsXHJcbiAgICAgICAgICAgIHNpemVzOiBmYWxzZVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgcHJpdmF0ZSBfc3Vic2NyaXB0aW9uX0Jvb3RzdHJhcDogU3Vic2NyaXB0aW9uO1xyXG4gICAgcHJpdmF0ZSBfc3Vic2NyaXB0aW9uX0Jyb3dzZXI6IFN1YnNjcmlwdGlvbjtcclxuICAgIHByaXZhdGUgX3N1YnNjcmlwdGlvbl9QaXhlbF9SYXRpbzogU3Vic2NyaXB0aW9uO1xyXG4gICAgcHJpdmF0ZSBfc3Vic2NyaXB0aW9uX0RldmljZTogU3Vic2NyaXB0aW9uO1xyXG4gICAgcHJpdmF0ZSBfc3Vic2NyaXB0aW9uX09yaWVudGF0aW9uOiBTdWJzY3JpcHRpb247XHJcbiAgICBwcml2YXRlIF9zdWJzY3JpcHRpb25fU3RhbmRhcmQ6IFN1YnNjcmlwdGlvbjtcclxuICAgIHByaXZhdGUgX3N1YnNjcmlwdGlvbl9JRV9WZXJzaW9uOiBTdWJzY3JpcHRpb247XHJcbiAgICBwcml2YXRlIF9zdWJzY3JpcHRpb25fY3VzdG9tX3NpemVzOiBTdWJzY3JpcHRpb247XHJcblxyXG5cclxuICAgIHByb3RlY3RlZCBfc2hvd1doZW5UcnVlID0gdHJ1ZTtcclxuICAgIHByaXZhdGUgX2dsb2JhbE5vUmVwZWF0ID0gMDtcclxuICAgIHByaXZhdGUgX25vUmVwZWF0Qm9vdHN0cmFwTmFtZTogc3RyaW5nO1xyXG5cclxuICAgIHByaXZhdGUgX2Jvb3RzdHJhcE5vUmVwZWF0ID0gMDtcclxuICAgIHByaXZhdGUgX2RldmljZU5vUmVwZWF0ID0gMDtcclxuICAgIHByaXZhdGUgX3N0YW5kYXJkTm9SZXBlYXQgPSAwO1xyXG4gICAgcHJpdmF0ZSBfb3JpZW50YXRpb25Ob1JlcGVhdCA9IDA7XHJcbiAgICBwcml2YXRlIF9icm93c2VyTm9SZXBlYXQgPSAwO1xyXG4gICAgcHJpdmF0ZSBfcGl4ZWxyYXRpb05vUmVwZWF0ID0gMDtcclxuICAgIHByaXZhdGUgX2llTm9SZXBlYXQgPSAwO1xyXG4gICAgcHJpdmF0ZSBfc2l6ZXNOb1JlcGVhdCA9IDA7XHJcblxyXG4gICAgcHJpdmF0ZSBfYm9vdHN0cmFwX3VzZXJfcGFyYW06IHN0cmluZ1tdID0gW107XHJcbiAgICBwcml2YXRlIF9kZXZpY2VzX3VzZXJfcGFyYW06IHN0cmluZ1tdID0gW107XHJcbiAgICBwcml2YXRlIF9zdGFuZGFyZF91c2VyX3BhcmFtOiBzdHJpbmdbXSA9IFtdO1xyXG4gICAgcHJpdmF0ZSBfb3JpZW50YXRpb25fdXNlcl9wYXJhbTogc3RyaW5nW10gPSBbXTtcclxuICAgIHByaXZhdGUgX2Jyb3dzZXJfdXNlcl9wYXJhbTogc3RyaW5nW10gPSBbXTtcclxuICAgIHByaXZhdGUgX3BpeGVscmF0aW9fdXNlcl9wYXJhbTogc3RyaW5nW10gPSBbXTtcclxuICAgIHByaXZhdGUgX2llX3VzZXJfcGFyYW06IHN0cmluZ1tdID0gW107XHJcbiAgICBwcml2YXRlIF9zaXplc191c2VyX3BhcmFtOiBbbnVtYmVyLCBudW1iZXJdID0gWzAsIE51bWJlci5NQVhfVkFMVUVdO1xyXG4gICAgcHJpdmF0ZSBfc2l6ZXNfd2luZG93ID0gJ3dpbmRvdyc7XHJcbiAgICAvLyBwcml2YXRlIF9zaXplc19jb250YWluZXIgPSBudWxsO1xyXG5cclxuICAgIHByb3RlY3RlZCBfYWN0aXZlczogc3RyaW5nW10gPSBbXTtcclxuXHJcbiAgICBjb25zdHJ1Y3RvcihcclxuICAgICAgICBwdWJsaWMgdGVtcGxhdGVSZWY6IFRlbXBsYXRlUmVmPE9iamVjdD4sXHJcbiAgICAgICAgcHJpdmF0ZSBfcmVzcG9uc2l2ZVN0YXRlOiBSZXNwb25zaXZlU3RhdGUsXHJcbiAgICAgICAgcHJpdmF0ZSB2aWV3Q29udGFpbmVyOiBWaWV3Q29udGFpbmVyUmVmLFxyXG4gICAgICAgIHByaXZhdGUgY2Q6IENoYW5nZURldGVjdG9yUmVmLFxyXG4gICAgICAgIHBsYXRmb3JtU2VydmljZTogUGxhdGZvcm1TZXJ2aWNlXHJcbiAgICApIHtcclxuICAgICAgICB0aGlzLl9pc0VuYWJsZWRGb3JQbGF0Zm9ybSA9IHBsYXRmb3JtU2VydmljZS5pc0VuYWJsZWRGb3JQbGF0Zm9ybSgpO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBpbml0X3Jlc3BvbnNpdmUoKTogdm9pZCB7XHJcbiAgICAgICAgY29uc3QgY29uZmlnOiBhbnkgPSB0aGlzLmNvbmZpZztcclxuICAgICAgICBpZiAodGhpcy5pc0pTT04oY29uZmlnKSkge1xyXG4gICAgICAgICAgICBpZiAoISFjb25maWcuYm9vdHN0cmFwICYmIHRoaXMuX2Jvb3RzdHJhcE5vUmVwZWF0ID09PSAwKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9ib290c3RyYXBfdXNlcl9wYXJhbSA9IDxzdHJpbmdbXT4oQXJyYXkuaXNBcnJheShjb25maWcuYm9vdHN0cmFwKSA/IGNvbmZpZy5ib290c3RyYXAgOiBbY29uZmlnLmJvb3RzdHJhcF0pO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fYm9vdHN0cmFwTm9SZXBlYXQgPSAxO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zZXRfYWN0aXZlX3N1YnNjcmlwdGlvbnMuYm9vdHN0cmFwID0gdHJ1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoISFjb25maWcuZGV2aWNlICYmIHRoaXMuX2RldmljZU5vUmVwZWF0ID09PSAwKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9kZXZpY2VzX3VzZXJfcGFyYW0gPSA8c3RyaW5nW10+KEFycmF5LmlzQXJyYXkoY29uZmlnLmRldmljZSkgPyBjb25maWcuZGV2aWNlIDogW2NvbmZpZy5kZXZpY2VdKTtcclxuICAgICAgICAgICAgICAgIHRoaXMuX2RldmljZU5vUmVwZWF0ID0gMTtcclxuICAgICAgICAgICAgICAgIHRoaXMuc2V0X2FjdGl2ZV9zdWJzY3JpcHRpb25zLmRldmljZSA9IHRydWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKCEhY29uZmlnLnN0YW5kYXJkICYmIHRoaXMuX3N0YW5kYXJkTm9SZXBlYXQgPT09IDApIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuX3N0YW5kYXJkX3VzZXJfcGFyYW0gPSA8c3RyaW5nW10+KEFycmF5LmlzQXJyYXkoY29uZmlnLnN0YW5kYXJkKSA/IGNvbmZpZy5zdGFuZGFyZCA6IFtjb25maWcuc3RhbmRhcmRdKTtcclxuICAgICAgICAgICAgICAgIHRoaXMuX3N0YW5kYXJkTm9SZXBlYXQgPSAxO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zZXRfYWN0aXZlX3N1YnNjcmlwdGlvbnMuc3RhbmRhcmQgPSB0cnVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmICghIWNvbmZpZy5vcmllbnRhdGlvbiAmJiB0aGlzLl9vcmllbnRhdGlvbk5vUmVwZWF0ID09PSAwKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9vcmllbnRhdGlvbl91c2VyX3BhcmFtID0gPHN0cmluZ1tdPihBcnJheS5pc0FycmF5KGNvbmZpZy5vcmllbnRhdGlvbikgPyBjb25maWcub3JpZW50YXRpb24gOiBbY29uZmlnLm9yaWVudGF0aW9uXSk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9vcmllbnRhdGlvbk5vUmVwZWF0ID0gMTtcclxuICAgICAgICAgICAgICAgIHRoaXMuc2V0X2FjdGl2ZV9zdWJzY3JpcHRpb25zLm9yaWVudGF0aW9uID0gdHJ1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoISFjb25maWcuYnJvd3NlciAmJiB0aGlzLl9icm93c2VyTm9SZXBlYXQgPT09IDApIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuX2Jyb3dzZXJfdXNlcl9wYXJhbSA9IDxzdHJpbmdbXT4oQXJyYXkuaXNBcnJheShjb25maWcuYnJvd3NlcikgPyBjb25maWcuYnJvd3NlciA6IFtjb25maWcuYnJvd3Nlcl0pO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fYnJvd3Nlck5vUmVwZWF0ID0gMTtcclxuICAgICAgICAgICAgICAgIHRoaXMuc2V0X2FjdGl2ZV9zdWJzY3JpcHRpb25zLmJyb3dzZXIgPSB0cnVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmICghIWNvbmZpZy5waXhlbHJhdGlvICYmIHRoaXMuX3BpeGVscmF0aW9Ob1JlcGVhdCA9PT0gMCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fcGl4ZWxyYXRpb191c2VyX3BhcmFtID0gPHN0cmluZ1tdPihBcnJheS5pc0FycmF5KGNvbmZpZy5waXhlbHJhdGlvKSA/IGNvbmZpZy5waXhlbHJhdGlvIDogW2NvbmZpZy5waXhlbHJhdGlvXSk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9waXhlbHJhdGlvTm9SZXBlYXQgPSAxO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zZXRfYWN0aXZlX3N1YnNjcmlwdGlvbnMucGl4ZWxyYXRpbyA9IHRydWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKCEhY29uZmlnLmllICYmIHRoaXMuX2llTm9SZXBlYXQgPT09IDApIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuX2llX3VzZXJfcGFyYW0gPSA8c3RyaW5nW10+KEFycmF5LmlzQXJyYXkoY29uZmlnLmllKSA/IGNvbmZpZy5pZSA6IFtjb25maWcuaWVdKTtcclxuICAgICAgICAgICAgICAgIHRoaXMuX2llTm9SZXBlYXQgPSAxO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zZXRfYWN0aXZlX3N1YnNjcmlwdGlvbnMuaWUgPSB0cnVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmICghIWNvbmZpZy5zaXplcyAmJiB0aGlzLl9zaXplc05vUmVwZWF0ID09PSAwKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBfbWluID0gY29uZmlnLnNpemVzLm1pbiB8fCAwO1xyXG4gICAgICAgICAgICAgICAgY29uc3QgX21heCA9IGNvbmZpZy5zaXplcy5tYXggfHwgTnVtYmVyLk1BWF9WQUxVRTtcclxuICAgICAgICAgICAgICAgIGNvbnN0IF93aW4gPSBjb25maWcuc2l6ZXMud2luZG93O1xyXG4gICAgICAgICAgICAgICAgaWYgKF93aW4gIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3NpemVzX3dpbmRvdyA9IF93aW47XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAvLyB0aGlzLl9zaXplc19jb250YWluZXIgPSB2YWx1ZS5zaXplcy5jb250YWluZXI7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9zaXplc191c2VyX3BhcmFtID0gW19taW4sIF9tYXhdO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fc2l6ZXNOb1JlcGVhdCA9IDE7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnNldF9hY3RpdmVfc3Vic2NyaXB0aW9ucy5zaXplcyA9IHRydWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9IGVsc2UgaWYgKEFycmF5LmlzQXJyYXkoY29uZmlnKSkge1xyXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1Jlc3BvbnNpdmUgZGlyZWN0aXZlIGRvbsK0dCB3b3JrIHdpdGggYSBvbmx5IGFycmF5IHBhcmFtZXRlcicpO1xyXG4gICAgICAgIH0gZWxzZSBpZiAodHlwZW9mIGNvbmZpZyA9PT0gJ3N0cmluZycpIHtcclxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdSZXNwb25zaXZlIGRpcmVjdGl2ZSBkb27CtHQgd29yayB3aXRoIGEgb25seSBzdHJpbmcgcGFyYW1ldGVyJyk7XHJcbiAgICAgICAgfSBlbHNlIGlmICh0eXBlb2YgY29uZmlnID09PSAnbnVtYmVyJykge1xyXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1Jlc3BvbnNpdmUgZGlyZWN0aXZlIGRvbsK0dCB3b3JrIHdpdGggYSBvbmx5IG51bWJlciBwYXJhbWV0ZXInKTtcclxuICAgICAgICB9IGVsc2UgaWYgKHR5cGVvZiBjb25maWcgPT09ICd1bmRlZmluZWQnIHx8IGNvbmZpZyA9PT0gbnVsbCkge1xyXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1Jlc3BvbnNpdmUgZGlyZWN0aXZlIGRvbsK0dCB3b3JrIHdpdGhvdXQgYSBwYXJhbScpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZm9yIChsZXQga2V5IGluIHRoaXMuc2V0X2FjdGl2ZV9zdWJzY3JpcHRpb25zKSB7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLnNldF9hY3RpdmVfc3Vic2NyaXB0aW9uc1trZXldKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9hY3RpdmVzLnB1c2goa2V5KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAodGhpcy5faXNFbmFibGVkRm9yUGxhdGZvcm0pIHtcclxuICAgICAgICAgICAgaWYgKHRoaXMuc2V0X2FjdGl2ZV9zdWJzY3JpcHRpb25zLmJvb3RzdHJhcCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fc3Vic2NyaXB0aW9uX0Jvb3RzdHJhcCA9IHRoaXMuX3Jlc3BvbnNpdmVTdGF0ZS5lbGVtZW50byQuc3Vic2NyaWJlKHRoaXMudXBkYXRlQm9vdHN0cmFwLmJpbmQodGhpcykpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmICh0aGlzLnNldF9hY3RpdmVfc3Vic2NyaXB0aW9ucy5icm93c2VyKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9zdWJzY3JpcHRpb25fQnJvd3NlciA9IHRoaXMuX3Jlc3BvbnNpdmVTdGF0ZS5icm93c2VyJC5zdWJzY3JpYmUodGhpcy51cGRhdGVCcm93c2VyLmJpbmQodGhpcykpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAodGhpcy5zZXRfYWN0aXZlX3N1YnNjcmlwdGlvbnMuZGV2aWNlKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9zdWJzY3JpcHRpb25fRGV2aWNlID0gdGhpcy5fcmVzcG9uc2l2ZVN0YXRlLmRldmljZSQuc3Vic2NyaWJlKHRoaXMudXBkYXRlRGV2aWNlLmJpbmQodGhpcykpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAodGhpcy5zZXRfYWN0aXZlX3N1YnNjcmlwdGlvbnMucGl4ZWxyYXRpbykge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fc3Vic2NyaXB0aW9uX1BpeGVsX1JhdGlvID0gdGhpcy5fcmVzcG9uc2l2ZVN0YXRlLnBpeGVsJC5zdWJzY3JpYmUodGhpcy51cGRhdGVQaXhlbFJhdGlvLmJpbmQodGhpcykpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAodGhpcy5zZXRfYWN0aXZlX3N1YnNjcmlwdGlvbnMub3JpZW50YXRpb24pIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuX3N1YnNjcmlwdGlvbl9PcmllbnRhdGlvbiA9IHRoaXMuX3Jlc3BvbnNpdmVTdGF0ZS5vcmllbnRhdGlvbiQuc3Vic2NyaWJlKHRoaXMudXBkYXRlT3JpZW50YXRpb24uYmluZCh0aGlzKSk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmICh0aGlzLnNldF9hY3RpdmVfc3Vic2NyaXB0aW9ucy5zdGFuZGFyZCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fc3Vic2NyaXB0aW9uX1N0YW5kYXJkID0gdGhpcy5fcmVzcG9uc2l2ZVN0YXRlLnN0YW5kYXJkJC5zdWJzY3JpYmUodGhpcy51cGRhdGVTdGFuZGFyZC5iaW5kKHRoaXMpKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKHRoaXMuc2V0X2FjdGl2ZV9zdWJzY3JpcHRpb25zLmllKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9zdWJzY3JpcHRpb25fSUVfVmVyc2lvbiA9IHRoaXMuX3Jlc3BvbnNpdmVTdGF0ZS5pZVZlcnNpb24kLnN1YnNjcmliZSh0aGlzLnVwZGF0ZUlFdmVyc2lvbi5iaW5kKHRoaXMpKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKHRoaXMuc2V0X2FjdGl2ZV9zdWJzY3JpcHRpb25zLnNpemVzKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9zdWJzY3JpcHRpb25fY3VzdG9tX3NpemVzID0gdGhpcy5fcmVzcG9uc2l2ZVN0YXRlLmFuY2hvJC5zdWJzY3JpYmUodGhpcy51cGRhdGVTaXplcy5iaW5kKHRoaXMpKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIHVwZGF0ZUJvb3RzdHJhcCh2YWx1ZTogc3RyaW5nKTogdm9pZCB7XHJcbiAgICAgICAgY29uc3QgX3VwZGF0ZSA9IHRoaXMuX2lmVmFsdWVDaGFuZ2VkKHRoaXMuX25vUmVwZWF0Qm9vdHN0cmFwTmFtZSwgdmFsdWUpO1xyXG4gICAgICAgIGlmIChfdXBkYXRlKSB7XHJcbiAgICAgICAgICAgIHRoaXMuc2V0X3ZhbHVlcy5ib290c3RyYXAgPSB2YWx1ZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy51cGRhdGVFdmVudCh0aGlzLnNldF92YWx1ZXMuYm9vdHN0cmFwLCAnYm9vdHN0cmFwJyk7XHJcbiAgICB9XHJcbiAgICBwcml2YXRlIHVwZGF0ZUJyb3dzZXIodmFsdWU6IHN0cmluZyk6IHZvaWQge1xyXG4gICAgICAgIHRoaXMuc2V0X3ZhbHVlcy5icm93c2VyID0gdmFsdWU7XHJcbiAgICAgICAgdGhpcy51cGRhdGVFdmVudCh0aGlzLnNldF92YWx1ZXMuYnJvd3NlciwgJ2Jyb3dzZXInKTtcclxuICAgIH1cclxuICAgIHByaXZhdGUgdXBkYXRlRGV2aWNlKHZhbHVlOiBzdHJpbmcpOiB2b2lkIHtcclxuICAgICAgICB0aGlzLnNldF92YWx1ZXMuZGV2aWNlID0gdmFsdWU7XHJcbiAgICAgICAgdGhpcy51cGRhdGVFdmVudCh0aGlzLnNldF92YWx1ZXMuZGV2aWNlLCAnZGV2aWNlJyk7XHJcbiAgICB9XHJcbiAgICBwcml2YXRlIHVwZGF0ZVBpeGVsUmF0aW8odmFsdWU6IHN0cmluZyk6IHZvaWQge1xyXG4gICAgICAgIHRoaXMuc2V0X3ZhbHVlcy5waXhlbHJhdGlvID0gdmFsdWU7XHJcbiAgICAgICAgdGhpcy51cGRhdGVFdmVudCh0aGlzLnNldF92YWx1ZXMucGl4ZWxyYXRpbywgJ3BpeGVscmF0aW8nKTtcclxuICAgIH1cclxuICAgIHByaXZhdGUgdXBkYXRlT3JpZW50YXRpb24odmFsdWU6IHN0cmluZyk6IHZvaWQge1xyXG4gICAgICAgIHRoaXMuc2V0X3ZhbHVlcy5vcmllbnRhdGlvbiA9IHZhbHVlO1xyXG4gICAgICAgIHRoaXMudXBkYXRlRXZlbnQodGhpcy5zZXRfdmFsdWVzLm9yaWVudGF0aW9uLCAnb3JpZW50YXRpb24nKTtcclxuICAgIH1cclxuICAgIHByaXZhdGUgdXBkYXRlU3RhbmRhcmQodmFsdWU6IHN0cmluZyk6IHZvaWQge1xyXG4gICAgICAgIHRoaXMuc2V0X3ZhbHVlcy5zdGFuZGFyZCA9IHZhbHVlO1xyXG4gICAgICAgIHRoaXMudXBkYXRlRXZlbnQodGhpcy5zZXRfdmFsdWVzLnN0YW5kYXJkLCAnc3RhbmRhcmQnKTtcclxuICAgIH1cclxuICAgIHByaXZhdGUgdXBkYXRlSUV2ZXJzaW9uKHZhbHVlOiBzdHJpbmcpOiB2b2lkIHtcclxuICAgICAgICB0aGlzLnNldF92YWx1ZXMuaWUgPSB2YWx1ZTtcclxuICAgICAgICB0aGlzLnVwZGF0ZUV2ZW50KHRoaXMuc2V0X3ZhbHVlcy5pZSwgJ2llJyk7XHJcbiAgICB9XHJcbiAgICBwcml2YXRlIHVwZGF0ZVNpemVzKHZhbHVlOiBudW1iZXIpOiB2b2lkIHtcclxuICAgICAgICBpZih0aGlzLnJlc3BvbnNpdmVDb250YWluZXIpe1xyXG4gICAgICAgICAgICB0aGlzLnNldF92YWx1ZXMuc2l6ZXMgPSB0aGlzLl9pc0VuYWJsZWRGb3JQbGF0Zm9ybSA/IHRoaXMucmVzcG9uc2l2ZUNvbnRhaW5lci5nZXRXaWR0aCgpIDogMDtcclxuICAgICAgICB9ZWxzZSBpZiAodGhpcy5fc2l6ZXNfd2luZG93KXtcclxuICAgICAgICAgICAgdGhpcy5zZXRfdmFsdWVzLnNpemVzID0gdGhpcy5fcmVzcG9uc2l2ZVN0YXRlLmdldFdpZHRoKHRoaXMuX3NpemVzX3dpbmRvdyk7XHJcbiAgICAgICAgfWVsc2V7XHJcbiAgICAgICAgICAgIHRoaXMuc2V0X3ZhbHVlcy5zaXplcyA9IHZhbHVlO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLnVwZGF0ZUV2ZW50KHRoaXMuc2V0X3ZhbHVlcy5zaXplcywgJ3NpemVzJyk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSB1cGRhdGVFdmVudChwYXJhbTogYW55LCB0eXBlX2RpcmVjdGl2ZTogc3RyaW5nKTogdm9pZCB7XHJcbiAgICAgICAgaWYgKCEhdGhpcy5fc2hvd1doZW5UcnVlKSB7XHJcbiAgICAgICAgICAgIHN3aXRjaCAodHlwZV9kaXJlY3RpdmUpIHtcclxuICAgICAgICAgICAgICAgIGNhc2UgJ2Jvb3RzdHJhcCc6XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zaG93SGlkZU9wZXJhdGlvbnModGhpcy5fYm9vdHN0cmFwX3VzZXJfcGFyYW0uaW5kZXhPZihwYXJhbSkgIT09IC0xLCB0eXBlX2RpcmVjdGl2ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICBjYXNlICdkZXZpY2UnOlxyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd0hpZGVPcGVyYXRpb25zKHRoaXMuX2RldmljZXNfdXNlcl9wYXJhbS5pbmRleE9mKHBhcmFtKSAhPT0gLTEsIHR5cGVfZGlyZWN0aXZlKTtcclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIGNhc2UgJ3N0YW5kYXJkJzpcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3dIaWRlT3BlcmF0aW9ucyh0aGlzLl9zdGFuZGFyZF91c2VyX3BhcmFtLmluZGV4T2YocGFyYW0pICE9PSAtMSwgdHlwZV9kaXJlY3RpdmUpO1xyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgY2FzZSAnb3JpZW50YXRpb24nOlxyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd0hpZGVPcGVyYXRpb25zKHRoaXMuX29yaWVudGF0aW9uX3VzZXJfcGFyYW0uaW5kZXhPZihwYXJhbSkgIT09IC0xLCB0eXBlX2RpcmVjdGl2ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICBjYXNlICdicm93c2VyJzpcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3dIaWRlT3BlcmF0aW9ucyh0aGlzLl9icm93c2VyX3VzZXJfcGFyYW0uaW5kZXhPZihwYXJhbSkgIT09IC0xLCB0eXBlX2RpcmVjdGl2ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICBjYXNlICdwaXhlbHJhdGlvJzpcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3dIaWRlT3BlcmF0aW9ucyh0aGlzLl9waXhlbHJhdGlvX3VzZXJfcGFyYW0uaW5kZXhPZihwYXJhbSkgIT09IC0xLCB0eXBlX2RpcmVjdGl2ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICBjYXNlICdpZSc6XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zaG93SGlkZU9wZXJhdGlvbnModGhpcy5faWVfdXNlcl9wYXJhbS5pbmRleE9mKHBhcmFtKSAhPT0gLTEsIHR5cGVfZGlyZWN0aXZlKTtcclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIGNhc2UgJ3NpemVzJzpcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3dIaWRlT3BlcmF0aW9ucyhcclxuICAgICAgICAgICAgICAgICAgICAgICAgKFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFyYW0gPj0gdGhpcy5fc2l6ZXNfdXNlcl9wYXJhbVswXSAmJlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFyYW0gPCB0aGlzLl9zaXplc191c2VyX3BhcmFtWzFdXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGVfZGlyZWN0aXZlKTtcclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0gZWxzZSB7XHJcblxyXG4gICAgICAgICAgICBzd2l0Y2ggKHR5cGVfZGlyZWN0aXZlKSB7XHJcbiAgICAgICAgICAgICAgICBjYXNlICdib290c3RyYXAnOlxyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd0hpZGVPcGVyYXRpb25zKCEodGhpcy5fYm9vdHN0cmFwX3VzZXJfcGFyYW0uaW5kZXhPZihwYXJhbSkpLCB0eXBlX2RpcmVjdGl2ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICBjYXNlICdkZXZpY2UnOlxyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd0hpZGVPcGVyYXRpb25zKCEodGhpcy5fZGV2aWNlc191c2VyX3BhcmFtLmluZGV4T2YocGFyYW0pKSwgdHlwZV9kaXJlY3RpdmUpO1xyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgY2FzZSAnc3RhbmRhcmQnOlxyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd0hpZGVPcGVyYXRpb25zKCEodGhpcy5fc3RhbmRhcmRfdXNlcl9wYXJhbS5pbmRleE9mKHBhcmFtKSksIHR5cGVfZGlyZWN0aXZlKTtcclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIGNhc2UgJ29yaWVudGF0aW9uJzpcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3dIaWRlT3BlcmF0aW9ucyghKHRoaXMuX29yaWVudGF0aW9uX3VzZXJfcGFyYW0uaW5kZXhPZihwYXJhbSkpLCB0eXBlX2RpcmVjdGl2ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICBjYXNlICdicm93c2VyJzpcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3dIaWRlT3BlcmF0aW9ucyghKHRoaXMuX2Jyb3dzZXJfdXNlcl9wYXJhbS5pbmRleE9mKHBhcmFtKSksIHR5cGVfZGlyZWN0aXZlKTtcclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIGNhc2UgJ3BpeGVscmF0aW8nOlxyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd0hpZGVPcGVyYXRpb25zKCEodGhpcy5fcGl4ZWxyYXRpb191c2VyX3BhcmFtLmluZGV4T2YocGFyYW0pKSwgdHlwZV9kaXJlY3RpdmUpO1xyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgY2FzZSAnaWUnOlxyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd0hpZGVPcGVyYXRpb25zKCEodGhpcy5faWVfdXNlcl9wYXJhbS5pbmRleE9mKHBhcmFtKSksIHR5cGVfZGlyZWN0aXZlKTtcclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIGNhc2UgJ3NpemVzJzpcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3dIaWRlT3BlcmF0aW9ucyghKChcclxuICAgICAgICAgICAgICAgICAgICAgICAgcGFyYW0gPj0gdGhpcy5fc2l6ZXNfdXNlcl9wYXJhbVswXSAmJlxyXG4gICAgICAgICAgICAgICAgICAgICAgICBwYXJhbSA8IHRoaXMuX3NpemVzX3VzZXJfcGFyYW1bMV0pKSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgdHlwZV9kaXJlY3RpdmUpO1xyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgc2hvd0hpZGVPcGVyYXRpb25zKHNob3c6IGJvb2xlYW4sIHR5cGVfZGlyZWN0aXZlOiBzdHJpbmcpOiB2b2lkIHtcclxuICAgICAgICBjb25zdCBnbG9iYWxfc3RhdGUgPSB0aGlzLm1hdGNoVmFsdWVzKHNob3csIHR5cGVfZGlyZWN0aXZlKTtcclxuICAgICAgICBpZiAoISFnbG9iYWxfc3RhdGUpIHtcclxuICAgICAgICAgICAgaWYgKHRoaXMuX2dsb2JhbE5vUmVwZWF0ID09PSAwKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9nbG9iYWxOb1JlcGVhdCA9IDE7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnZpZXdDb250YWluZXIuY3JlYXRlRW1iZWRkZWRWaWV3KHRoaXMudGVtcGxhdGVSZWYpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5jaGFuZ2VzLmVtaXQodHJ1ZSk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmNkLm1hcmtGb3JDaGVjaygpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy5fZ2xvYmFsTm9SZXBlYXQgPSAwO1xyXG4gICAgICAgICAgICB0aGlzLmNoYW5nZXMuZW1pdChmYWxzZSk7XHJcbiAgICAgICAgICAgIHRoaXMudmlld0NvbnRhaW5lci5jbGVhcigpO1xyXG4gICAgICAgICAgICB0aGlzLmNkLm1hcmtGb3JDaGVjaygpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIG1hdGNoVmFsdWVzKHNob3c6IGJvb2xlYW4sIHR5cGVfZGlyZWN0aXZlOiBzdHJpbmcpIHtcclxuICAgICAgICBsZXQgbWF0Y2ggPSB0cnVlO1xyXG4gICAgICAgIGlmIChzaG93KSB7XHJcbiAgICAgICAgICAgIHRoaXMubWF0Y2hfbXVsdGlwbGVbdHlwZV9kaXJlY3RpdmVdID0gdHJ1ZTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLm1hdGNoX211bHRpcGxlW3R5cGVfZGlyZWN0aXZlXSA9IGZhbHNlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZm9yIChsZXQgYWxsX2tleSBpbiB0aGlzLm1hdGNoX211bHRpcGxlKSB7XHJcbiAgICAgICAgICAgIGZvciAobGV0IGFjdGl2ZSBvZiB0aGlzLl9hY3RpdmVzKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoYWxsX2tleSA9PSBhY3RpdmUgJiYgdGhpcy5tYXRjaF9tdWx0aXBsZVthbGxfa2V5XSA9PT0gZmFsc2UpXHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG1hdGNoID0gZmFsc2U7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIG1hdGNoO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBuZ09uRGVzdHJveSgpOiB2b2lkIHtcclxuICAgICAgICBpZiAodGhpcy5faXNFbmFibGVkRm9yUGxhdGZvcm0pIHtcclxuICAgICAgICAgICAgaWYgKHRoaXMuc2V0X2FjdGl2ZV9zdWJzY3JpcHRpb25zLmJvb3RzdHJhcCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fc3Vic2NyaXB0aW9uX0Jvb3RzdHJhcC51bnN1YnNjcmliZSgpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAodGhpcy5zZXRfYWN0aXZlX3N1YnNjcmlwdGlvbnMuYnJvd3Nlcikge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fc3Vic2NyaXB0aW9uX0Jyb3dzZXIudW5zdWJzY3JpYmUoKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKHRoaXMuc2V0X2FjdGl2ZV9zdWJzY3JpcHRpb25zLmRldmljZSkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fc3Vic2NyaXB0aW9uX0RldmljZS51bnN1YnNjcmliZSgpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAodGhpcy5zZXRfYWN0aXZlX3N1YnNjcmlwdGlvbnMucGl4ZWxyYXRpbykge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fc3Vic2NyaXB0aW9uX1BpeGVsX1JhdGlvLnVuc3Vic2NyaWJlKCk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmICh0aGlzLnNldF9hY3RpdmVfc3Vic2NyaXB0aW9ucy5vcmllbnRhdGlvbikge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fc3Vic2NyaXB0aW9uX09yaWVudGF0aW9uLnVuc3Vic2NyaWJlKCk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmICh0aGlzLnNldF9hY3RpdmVfc3Vic2NyaXB0aW9ucy5zdGFuZGFyZCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fc3Vic2NyaXB0aW9uX1N0YW5kYXJkLnVuc3Vic2NyaWJlKCk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmICh0aGlzLnNldF9hY3RpdmVfc3Vic2NyaXB0aW9ucy5pZSkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fc3Vic2NyaXB0aW9uX0lFX1ZlcnNpb24udW5zdWJzY3JpYmUoKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKHRoaXMuc2V0X2FjdGl2ZV9zdWJzY3JpcHRpb25zLnNpemVzKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9zdWJzY3JpcHRpb25fY3VzdG9tX3NpemVzLnVuc3Vic2NyaWJlKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBfaWZWYWx1ZUNoYW5nZWQob2xkVmFsdWU6IGFueSwgbmV3VmFsdWU6IGFueSk6IGJvb2xlYW4ge1xyXG4gICAgICAgIGlmIChvbGRWYWx1ZSA9PT0gbmV3VmFsdWUpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHRoaXMuX25vUmVwZWF0Qm9vdHN0cmFwTmFtZSA9IG5ld1ZhbHVlO1xyXG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBpc0pTT04odmFsdWU6IGFueSk6IGJvb2xlYW4ge1xyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgIEpTT04uc3RyaW5naWZ5KHZhbHVlKTtcclxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgfSBjYXRjaCAoZXgpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG4iXX0=